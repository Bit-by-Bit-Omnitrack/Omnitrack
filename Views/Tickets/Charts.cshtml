@{
    ViewData["Title"] = "Ticket Charts";
}

<div class="p-6 bg-white rounded-xl shadow-lg mt-8">
    <div class="text-center">
        <h2 class="text-3xl font-bold text-gray-800">Omnitrack Project Analytics</h2>
        <p class="mt-2 text-gray-600 max-w-2xl mx-auto">
            This dashboard provides a clear overview of ticket distribution within your projects. Visualize the number of tickets created and assigned to each team member to gain insight into workload and productivity.
        </p>
    </div>
    <hr class="my-6 border-gray-300" />
    <div class="flex items-center justify-center p-4 bg-blue-50 rounded-lg shadow-inner mb-6">
        <span class="text-xl font-medium text-gray-800">Total Tickets:</span>
        <span id="totalTicketsCount" class="ml-2 text-2xl font-bold text-blue-600"></span>
    </div>
    <div class="flex flex-col md:flex-row space-y-8 md:space-y-0 md:space-x-8">
        <div class="w-full md:w-1/2 bg-gray-50 p-4 rounded-xl shadow-md">
            <h3 class="text-lg font-semibold text-center mb-4">Tickets Created by User</h3>
            <canvas id="createdTicketsChart"></canvas>
        </div>
        <div class="w-full md:w-1/2 bg-gray-50 p-4 rounded-xl shadow-md">
            <h3 class="text-lg font-semibold text-center mb-4">Tickets Assigned to User</h3>
            <canvas id="assignedTicketsChart"></canvas>
        </div>
    </div>
</div>

@section Scripts {
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://www.google.com/search?q=https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        $(document).ready(function () {
        // Fetch data from the controller
        $.getJSON('/Tickets/ChartData', function (data) {
        // Fix: Access the properties using camelCase, as is the default
        // behavior of ASP.NET Core's JSON serializer.
        const createdLabels = Object.keys(data.created);
        const createdCounts = Object.values(data.created);

                    const assignedLabels = Object.keys(data.assigned);
                    const assignedCounts = Object.values(data.assigned);

                    // Calculate the total number of tickets
                    const totalTickets = createdCounts.reduce((sum, count) => sum + count, 0);

                    // Display the total number of tickets in the dedicated element
                    document.getElementById('totalTicketsCount').textContent = totalTickets;

                    // Render the 'Tickets Created' chart
                    new Chart(document.getElementById('createdTicketsChart'), {
                        type: 'pie',
                        data: {
                            labels: createdLabels,
                            datasets: [{
                                label: 'Tickets Created',
                                data: createdCounts,
                                backgroundColor: [
                                    'rgba(44, 130, 201, 0.6)',   // Deep Blue
                                    'rgba(255, 165, 0, 0.6)',     // Warm Orange
                                    'rgba(119, 221, 119, 0.6)',   // Soft Green
                                    'rgba(128, 0, 128, 0.6)',     // Purple
                                    'rgba(105, 105, 105, 0.6)'    // Gray
                                ],
                                borderColor: [
                                    'rgba(44, 130, 201, 1)',
                                    'rgba(255, 165, 0, 1)',
                                    'rgba(119, 221, 119, 1)',
                                    'rgba(128, 0, 128, 1)',
                                    'rgba(105, 105, 105, 1)'
                                ],
                                borderWidth: 1
                            }]
                        },
                        options: {
                            responsive: true,
                            plugins: {
                                legend: {
                                    position: 'top',
                                },
                                title: {
                                    display: true,
                                    text: 'Tickets Created Per User'
                                }
                            }
                        }
                    });

                    // Render the 'Tickets Assigned' chart
                    new Chart(document.getElementById('assignedTicketsChart'), {
                        type: 'bar',
                        data: {
                            labels: assignedLabels,
                            datasets: [{
                                label: 'Tickets Assigned',
                                data: assignedCounts,
                                backgroundColor: 'rgba(54, 162, 235, 0.6)',
                                borderColor: 'rgba(54, 162, 235, 1)',
                                borderWidth: 1
                            }]
                        },
                        options: {
                            responsive: true,
                            plugins: {
                                legend: {
                                    display: false,
                                },
                                title: {
                                    display: true,
                                    text: 'Tickets Assigned Per User'
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true
                                }
                            }
                        }
                    });
                });
            });
    </script>

}